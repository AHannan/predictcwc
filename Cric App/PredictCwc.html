<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
        crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

    <script src="./script_basic.js"></script>

    <style>
        td.sum {
            font-size: 2em;
            text-align: center;
        }

        .sort{
            cursor: pointer;
        }
        
        .tab-heading {
            color: red;
        }

        table {
            border-collapse: collapse;
            /*remove spaces within cells */
            margin: 25px 0px;
            font-size: 0.9em;
            min-width: 400px;
        }

        .heading {
            width: 50px;
        }

        .cell {
            height: 50px;
        }

        .team {
            height: 50px;
            width: 100px;
        }

        .team-image {
            width: 20px;
            height: 20px;
        }

        .input-number {
            width: 100%;
            height: 100%;
            text-align: center;
            background-color: #f7eca8;
        }

        .team-name {
            padding: 2px 0 0 4px;
        }

        .cell-won {
            background-color: #4CAF50;
            border: none;
            color: white;
            text-align: center;
        }

        .cell-draw {
            background-color: rgb(186, 199, 74);
            border: none;
            color: white;
            text-align: center;
        }

        .cell-lost {
            background-color: rgb(182, 82, 95);
            border: none;
            color: white;
            text-align: center;
        }

        .cell-disabled {
            background-color: rgb(99, 92, 93);
            border: none;
            color: white;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="content">
        <!-- <div class="row col-md-12">
            <h2>Predict CWC</h2>
        </div> -->

        <div class="col-md-8">
            <h3 class="tab-heading">Cricket World Cup - All Combinations</h3>
            <table id="tbl-details">
                <tr>
                    <th class="heading" style="text-align: right;padding-right: 10px;">versus</th>
                    <th class="heading" id="head-eng">Eng</th>
                    <th class="heading" id="head-ind">Ind</th>
                    <th class="heading" id="head-aus">Aus</th>
                    <th class="heading" id="head-nzl">Nzl</th>
                    <th class="heading" id="head-pak">Pak</th>
                    <th class="heading" id="head-ban">Ban</th>
                    <th class="heading" id="head-win">WIN</th>
                    <th class="heading" id="head-saf">SAF</th>
                    <th class="heading" id="head-sri">Sri</th>
                    <th class="heading" id="head-afg">Afg</th>
                    <th class="heading sum sort" id="head-afg" onclick="sortTable(11, 'tbl-details')">Sum</th>
                </tr>
                <tr id="row-eng">
                    <td class="team" id="team-eng">
                        <img class="team-image">
                        <span class="team-name">England</span>
                    </td>
                    <td class="cell" id="eng-eng">-</td>
                    <td class="cell" id="eng-ind"></td>
                    <td class="cell" id="eng-aus"></td>
                    <td class="cell" id="eng-nzl"></td>
                    <td class="cell" id="eng-pak"></td>
                    <td class="cell" id="eng-ban"></td>
                    <td class="cell" id="eng-win"></td>
                    <td class="cell" id="eng-saf"></td>
                    <td class="cell" id="eng-sri"></td>
                    <td class="cell" id="eng-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-ind">
                    <td class="team" id="team-ind">
                        <img class="team-image">
                        <span class="team-name">India</span>
                    </td>
                    <td class="cell" id="ind-eng"></td>
                    <td class="cell" id="ind-ind">-</td>
                    <td class="cell" id="ind-aus"></td>
                    <td class="cell" id="ind-nzl"></td>
                    <td class="cell" id="ind-pak"></td>
                    <td class="cell" id="ind-ban"></td>
                    <td class="cell" id="ind-win"></td>
                    <td class="cell" id="ind-saf"></td>
                    <td class="cell" id="ind-sri"></td>
                    <td class="cell" id="ind-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-aus">
                    <td class="team" id="team-aus">
                        <img class="team-image">
                        <span class="team-name">Australia</span>
                    </td>
                    <td class="cell" id="aus-eng"></td>
                    <td class="cell" id="aus-ind"></td>
                    <td class="cell" id="aus-aus">-</td>
                    <td class="cell" id="aus-nzl"></td>
                    <td class="cell" id="aus-pak"></td>
                    <td class="cell" id="aus-ban"></td>
                    <td class="cell" id="aus-win"></td>
                    <td class="cell" id="aus-saf"></td>
                    <td class="cell" id="aus-sri"></td>
                    <td class="cell" id="aus-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-nzl">
                    <td class="cell" id="team-nzl">
                        <img class="team-image">
                        <span class="team-name">New Zealand</span>
                    </td>
                    <td class="cell" id="nzl-eng"></td>
                    <td class="cell" id="nzl-ind"></td>
                    <td class="cell" id="nzl-aus"></td>
                    <td class="cell" id="nzl-nzl">-</td>
                    <td class="cell" id="nzl-pak"></td>
                    <td class="cell" id="nzl-ban"></td>
                    <td class="cell" id="nzl-win"></td>
                    <td class="cell" id="nzl-saf"></td>
                    <td class="cell" id="nzl-sri"></td>
                    <td class="cell" id="nzl-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-pak">
                    <td class="cell" id="team-pak">
                        <img class="team-image">
                        <span class="team-name">Pakistan</span>
                    </td>
                    <td class="cell" id="pak-eng"></td>
                    <td class="cell" id="pak-ind"></td>
                    <td class="cell" id="pak-aus"></td>
                    <td class="cell" id="pak-nzl"></td>
                    <td class="cell" id="pak-pak">-</td>
                    <td class="cell" id="pak-ban"></td>
                    <td class="cell" id="pak-win"></td>
                    <td class="cell" id="pak-saf"></td>
                    <td class="cell" id="pak-sri"></td>
                    <td class="cell" id="pak-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-ban">
                    <td class="cell" id="team-ban">
                        <img class="team-image">
                        <span class="team-name">Bangladesh</span>
                    </td>
                    <td class="cell" id="ban-eng"></td>
                    <td class="cell" id="ban-ind"></td>
                    <td class="cell" id="ban-aus"></td>
                    <td class="cell" id="ban-nzl"></td>
                    <td class="cell" id="ban-pak"></td>
                    <td class="cell" id="ban-ban">-</td>
                    <td class="cell" id="ban-win"></td>
                    <td class="cell" id="ban-saf"></td>
                    <td class="cell" id="ban-sri"></td>
                    <td class="cell" id="ban-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-win">
                    <td class="cell" id="team-win">
                        <img class="team-image">
                        <span class="team-name">West Indies</span>
                    </td>
                    <td class="cell" id="win-eng"></td>
                    <td class="cell" id="win-ind"></td>
                    <td class="cell" id="win-aus"></td>
                    <td class="cell" id="win-nzl"></td>
                    <td class="cell" id="win-pak"></td>
                    <td class="cell" id="win-ban"></td>
                    <td class="cell" id="win-win">-</td>
                    <td class="cell" id="win-saf"></td>
                    <td class="cell" id="win-sri"></td>
                    <td class="cell" id="win-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-saf">
                    <td class="cell" id="team-saf">
                        <img class="team-image">
                        <span class="team-name">Soth Africa</span>
                    </td>
                    <td class="cell" id="saf-eng"></td>
                    <td class="cell" id="saf-ind"></td>
                    <td class="cell" id="saf-aus"></td>
                    <td class="cell" id="saf-nzl"></td>
                    <td class="cell" id="saf-pak"></td>
                    <td class="cell" id="saf-ban"></td>
                    <td class="cell" id="saf-win"></td>
                    <td class="cell" id="saf-saf">-</td>
                    <td class="cell" id="saf-sri"></td>
                    <td class="cell" id="saf-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-sri">
                    <td class="cell" id="team-sri">
                        <img class="team-image">
                        <span class="team-name">Sri Lanka</span>
                    </td>
                    <td class="cell" id="sri-eng"></td>
                    <td class="cell" id="sri-ind"></td>
                    <td class="cell" id="sri-aus"></td>
                    <td class="cell" id="sri-nzl"></td>
                    <td class="cell" id="sri-pak"></td>
                    <td class="cell" id="sri-ban"></td>
                    <td class="cell" id="sri-win"></td>
                    <td class="cell" id="sri-saf"></td>
                    <td class="cell" id="sri-sri">-</td>
                    <td class="cell" id="sri-afg"></td>
                    <td class="sum"></td>
                </tr>
                <tr id="row-afg">
                    <td class="cell" id="team-afg">
                        <img class="team-image">
                        <span class="team-name">Afghanistan</span>
                    </td>
                    <td class="cell" id="afg-eng"></td>
                    <td class="cell" id="afg-ind"></td>
                    <td class="cell" id="afg-aus"></td>
                    <td class="cell" id="afg-nzl"></td>
                    <td class="cell" id="afg-pak"></td>
                    <td class="cell" id="afg-ban"></td>
                    <td class="cell" id="afg-win"></td>
                    <td class="cell" id="afg-saf"></td>
                    <td class="cell" id="afg-sri"></td>
                    <td class="cell" id="afg-afg">-</td>
                    <td class="sum"></td>
                </tr>
            </table>
        </div>
        <div class="col-md-4">
            <h3 class="tab-heading">
                Qualification Chance
            </h3>
            <table id="tbl-chances">
                <tr>
                    <th>Teams</th>
                    <th class="heading sort" id="head-chance" onclick="sortTable(1, 'tbl-chances')">Chance</th>
                </tr>
                <tr>
                    <td class="team" id="team-eng">
                        <img class="team-image">
                        <span class="team-name">England</span>
                    </td>
                    <td id="chance-eng">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-ind">
                        <img class="team-image">
                        <span class="team-name">India</span>
                    </td>
                    <td id="chance-ind">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-aus">
                        <img class="team-image">
                        <span class="team-name">Australia</span>
                    </td>
                    <td id="chance-aus">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-nzl">
                        <img class="team-image">
                        <span class="team-name">Newzealand</span>
                    </td>
                    <td id="chance-nzl">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-pak">
                        <img class="team-image">
                        <span class="team-name">Pakistan</span>
                    </td>
                    <td id="chance-pak">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-ban">
                        <img class="team-image">
                        <span class="team-name">Bangladesh</span>
                    </td>
                    <td id="chance-ban">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-win">
                        <img class="team-image">
                        <span class="team-name">West Indies</span>
                    </td>
                    <td id="chance-win">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-saf">
                        <img class="team-image">
                        <span class="team-name">South Africa</span>
                    </td>
                    <td id="chance-saf">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-sri">
                        <img class="team-image">
                        <span class="team-name">Sri Lanka</span>
                    </td>
                    <td id="chance-sri">0</td>
                </tr>
                <tr>
                    <td class="team" id="team-afg">
                        <img class="team-image">
                        <span class="team-name">Afghanistan</span>
                    </td>
                    <td id="chance-afg">0</td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        
        /* ---
        Pre Steps Functions 
        --- */
        
        function refreshChanceTable() {
            // teamInfo is actually a global variable here
            $.each(teamInfo, function (team) {                
                var myVar = teamInfo[team]['scores'];
                var chance = 0;
                $.each(myVar, function (v) {
                   chance += parseFloat(teamInfo[team]['scores'][v]);
                });               

                chance = chance.toFixed(1);

                $('#chance-' + team).text(chance);
                $('#row-'+team+' .sum').text(chance);

            });

            sortTable(1, 'tbl-chances');
            sortTable(1, 'tbl-chances');
        }

        function getInputNumber(val, match) {
            return '<input id="num-' + match + '" type="number" value="' + val + '" class="input-number" min="0" max="1" step=".1">';
        }

        function getTeam(match, num) {
            var teamNames = match.split("-");
            return teamNames[num - 1];
        }

        function getKeysCount(myArray){
            return Object.keys(myArray).length;
        }

        /* --- 
        DATA 
        --- */

        // Team Info includes:
        // Order of teams arrangement. Note: This order is important        
        // Image numbers as present in espn cric info
        var teamInfo = 
        {
            "eng": { "imageNumber":  1, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {} },
            "ind": { "imageNumber":  6, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "aus": { "imageNumber":  2, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "nzl": { "imageNumber":  5, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "pak": { "imageNumber":  7, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "ban": { "imageNumber": 25, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "win": { "imageNumber":  4, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "saf": { "imageNumber":  3, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "sri": { "imageNumber":  8, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  },
            "afg": { "imageNumber": 40, "matches": 0, "won": 0, "lost": 0, "drawn" : 0, "points" : 0, "chance" : 0, "scores": {}  }
        };

        /*
        Round robin for 10 teams have 45 matches.
        Keys are created as "<team1>-<team2>"
        -   Result is the winning probabilty of team 1.
        -   Probability of Team 2 is auto-calculated below
        -   Completed describes if a game is completed
        */
        var matches =
        {
            "eng-ind": { "result": 0.6 },
            "eng-aus": { "result": 0.6 },
            "eng-nzl": { "result": 0.7 },
            "eng-pak": { "result": 0, "completed": 1 },
            "eng-ban": { "result": 0.7 },
            "eng-win": { "result": 0.7 },
            "eng-saf": { "result": 1, "completed": 1 },
            "eng-sri": { "result": 0.8 },
            "eng-afg": { "result": 0.8 },
            "ind-aus": { "result": 0.5 },
            "ind-nzl": { "result": 0.6 },
            "ind-pak": { "result": 0.7 },
            "ind-ban": { "result": 0.7 },
            "ind-win": { "result": 0.7 },
            "ind-saf": { "result": 1, "completed": 1 },
            "ind-sri": { "result": 0.8 },
            "ind-afg": { "result": 0.8 },
            "aus-nzl": { "result": 0.6 },
            "aus-pak": { "result": 0.6 },
            "aus-ban": { "result": 0.6 },
            "aus-win": { "result": 1, "completed": 1 },
            "aus-saf": { "result": 0.5 },
            "aus-sri": { "result": 0.8 },
            "aus-afg": { "result": 1, "completed": 1 },
            "nzl-pak": { "result": 0.5 },
            "nzl-ban": { "result": 1, "completed": 1 },
            "nzl-win": { "result": 0.5 },
            "nzl-saf": { "result": 0.5 },
            "nzl-sri": { "result": 1, "completed": 1 },
            "nzl-afg": { "result": 0.7 },
            "pak-ban": { "result": 1 },
            "pak-win": { "result": 0, "completed": 1 },
            "pak-saf": { "result": 0.5 },
            "pak-sri": { "result": 0.5, "completed": 1 },
            "pak-afg": { "result": 0.7 },
            "ban-win": { "result": 1 },
            "ban-saf": { "result": 0, "completed": 1 },
            "ban-sri": { "result": 0.7 },
            "ban-afg": { "result": 0.7 },
            "win-saf": { "result": 0.5 },
            "win-sri": { "result": 0.7 },
            "win-afg": { "result": 0.7 },
            "saf-sri": { "result": 0.7 },
            "saf-afg": { "result": 0.7 },
            "sri-afg": { "result": 0.7 },
        };
        
        /* STEPS */
        $.each(teamInfo, function (team) {
            // Disable matches i.e. a team's match against itself
            $("#" + team + "-" + team).addClass("cell-disabled");

            // Utilizing this loop to setup images as well
            // To-do: move these images locally from espn
            $('#team-' + team + ' img').attr("src", "https://a1.espncdn.com/combiner/i?img=/i/teamlogos/cricket/500/" + teamInfo[team]["imageNumber"] + ".png&amp;h=50&amp;w=50")
        });

        // Calculate scores for table 2
        $.each(matches, function (match) {
            
            var tName_1 = getTeam(match, 1);
            var tName_2 = getTeam(match, 2);

            var tSeq_1 = tName_1 + "-" + tName_2;
            var tSeq_2 = tName_2 + "-" + tName_1;

            var tClass_1 = 'cell-draw';
            var tClass_2 = 'cell-draw';
            
            var tResult_1 = matches[match]["result"]; // result is the probability/match result of first team            
            var tResult_2 = (1 - tResult_1).toFixed(1); // get result of team 2 from team 1
        
            // Set scores for "Combination" table
            if (!matches[match]["completed"]) {
                // Incompleted matches: Add a number textbox                
                $("#" + tSeq_1).html(getInputNumber(tResult_1, tSeq_1));
                $("#" + tSeq_2).html(getInputNumber(tResult_2, tSeq_2));
                
            } else {
                // Completed matches: Add Label
                $("#" + tSeq_1).text(tResult_1);
                $("#" + tSeq_2).text(tResult_2);

                teamInfo[tName_1]['matches'] += 1;
                teamInfo[tName_2]['matches'] += 1;

                // Setup color themes for completed matches
                if(tResult_1 > tResult_2){
                    tClass_1 = 'cell-won'; // WON: team 1
                    tClass_2 = 'cell-lost';

                    teamInfo[tName_1]['won'] += 1; teamInfo[tName_1]['points'] += 2;
                    teamInfo[tName_2]['lost'] += 1;
                } else if(tResult_1 < tResult_2){
                    tClass_1 = 'cell-lost';  // WON: team 2
                    tClass_2 = 'cell-won';

                    teamInfo[tName_1]['lost'] += 1;
                    teamInfo[tName_2]['won'] += 1; teamInfo[tName_2]['points'] += 2;
                }else{
                    teamInfo[tName_1]['drawn'] += 1; teamInfo[tName_1]['points'] += 1;
                    teamInfo[tName_2]['drawn'] += 1; teamInfo[tName_2]['points'] += 1;
                }

                $("#" + tSeq_1).addClass(tClass_1);
                $("#" + tSeq_2).addClass(tClass_2);
            }
            
            // Update Team Info
            teamInfo[tName_1]['scores'][tName_2] = tResult_1;
            teamInfo[tName_2]['scores'][tName_1] = tResult_2;

            //"eng": { "imageNumber": 1, "chance": 0, "matches": 0, "won": 0, "lost": 0, "drawn" : 0 },
            //updateTotal(teams[1]["result"], team2, team1Score, team2Score);

            /*
            var teams = {
                1 : { 'name': getTeam(match, 1), 'result': t1Result, 'seq': getTeam(match, 1) + "-" + getTeam(match, 2), 'class': 'cell-draw' },
                2 : { 'name': getTeam(match, 2), 'result': t2Result, 'seq': getTeam(match, 2) + "-" + getTeam(match, 1), 'class': 'cell-draw'},
            }
            */
           
            
        });
        
        // Refresh Table
        refreshChanceTable(teamInfo);
        
        /* --- 
        Post Steps Functions 
        --- */
        function numInputFunction(id, value) {
            
            var match = id.replace("num-", "");
            
            var tName_1 = getTeam(match, 1);
            var tName_2 = getTeam(match, 2);

            var tSeq_1 = tName_1 + "-" + tName_2;
            var tSeq_2 = tName_2 + "-" + tName_1;

            var tResult_1 = value; // same as the value of the number box
            var tResult_2 = (1 - tResult_1).toFixed(1); // get result of team 2 from team 1

            $("#num-" + tSeq_1).val(tResult_1);
            $("#num-" + tSeq_2).val(tResult_2); // Only needed to update the second team only though

            // Update scores of both teams against each other
            this.teamInfo[tName_1]['scores'][tName_2] = tResult_1;
            this.teamInfo[tName_2]['scores'][tName_1] = tResult_2;

            // Refresh Chance Table
            refreshChanceTable(teamInfo);

        }
        
        $(function () {
            $(":input").focus(function() { $(this).select(); } );
            $(":input").bind('keyup mouseup', function () {
                if (this.value) {
                    if (this.value > 1 || this.value < 0) {
                        this.value = 1;
                    } else {
                        numInputFunction(this.id, this.value);
                    }
                } else {
                    this.value = 0;
                }
            });
        });
    </script>
</body>

</html>